services:
  claw:
    build: .
    image: gather-claw:latest
    container_name: claw-dev
    env_file:
      - ../.env
    environment:
      - MODEL_PROVIDER=anthropic
      - CLAWPOINT_ROOT=/app
      - CLAWPOINT_DB=/app/data/messages.db
      - BUILD_SERVICE_URL=http://build-service:9090
      - ADK_WEBUI_ADDRESS=http://localhost:8080/api
    volumes:
      - ./dev-data:/app/data
      - ./dev-soul:/app/soul
      - ./dev-builds:/app/builds   # hot-swap: drop new binary here
    ports:
      - "8080:8081"   # ADK web UI + API (UI expects localhost:8080)
      - "8180:8080"   # proxy (public page + /api + /msg)
    mem_limit: 512m
    cpus: 1
    restart: unless-stopped
    depends_on:
      - build-service

  build-service:
    build:
      context: .
      dockerfile: Dockerfile.buildservice
    container_name: claw-build-service
    ports:
      - "127.0.0.1:9090:9090"
    mem_limit: 2g
    cpus: 2
    restart: unless-stopped

volumes: {}
