<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <title>skills.gather — Search</title>
  <%- include('partials/head') %>
</head>
<body>
  <%- include('partials/header') %>

  <main class="container">
    <h1>Search Skills</h1>

    <form method="get" action="/search">
      <div class="grid">
        <label>
          Search
          <input type="text" name="q" value="<%= q %>" placeholder="Search skills by name or description...">
        </label>
        <label>
          Category
          <select name="category">
            <option value="">All categories</option>
            <% categories.forEach(cat => { %>
            <option value="<%= cat %>" <%= category === cat ? 'selected' : '' %>><%= cat %></option>
            <% }) %>
          </select>
        </label>
      </div>
      <div class="grid">
        <label>
          Sort by
          <select name="sort">
            <option value="rank" <%= sort === 'rank' ? 'selected' : '' %>>Rank score</option>
            <option value="installs" <%= sort === 'installs' ? 'selected' : '' %>>Installs</option>
            <option value="reviews" <%= sort === 'reviews' ? 'selected' : '' %>>Most reviews</option>
            <option value="security" <%= sort === 'security' ? 'selected' : '' %>>Security score</option>
            <option value="newest" <%= sort === 'newest' ? 'selected' : '' %>>Newest</option>
          </select>
        </label>
        <label>
          Security filter
          <select name="min_security">
            <option value="" <%= !minSecurity ? 'selected' : '' %>>All skills</option>
            <option value="7" <%= minSecurity === '7' ? 'selected' : '' %>>Safe (7+)</option>
            <option value="5" <%= minSecurity === '5' ? 'selected' : '' %>>Moderate (5+)</option>
          </select>
        </label>
      </div>
      <button type="submit">Search</button>
    </form>

    <p style="opacity: 0.7;"><%= total %> skill<%= total !== 1 ? 's' : '' %> found</p>

    <% if (skills.length > 0) { %>
    <table>
      <thead>
        <tr>
          <th>Skill</th>
          <th>Score</th>
          <th>Security</th>
          <th>Reviews</th>
          <th>Installs</th>
        </tr>
      </thead>
      <tbody>
        <% skills.forEach(skill => { %>
        <tr>
          <td>
            <a href="/skills/<%= encodeURIComponent(skill.id) %>"><%= skill.name %></a>
            <% if (skill.category) { %>
            <span class="badge"><%= skill.category %></span>
            <% } %>
            <% if (skill.description) { %>
            <br><small style="opacity: 0.6"><%= skill.description.substring(0, 80) %><%= skill.description.length > 80 ? '...' : '' %></small>
            <% } %>
          </td>
          <td>
            <% if (skill.avg_score) { %>
            <span class="score <%= skill.avg_score >= 7 ? 'score-high' : skill.avg_score >= 5 ? 'score-mid' : 'score-low' %>">
              <%= skill.avg_score.toFixed(1) %>/10
            </span>
            <% } else { %>
            <span style="opacity: 0.5">--</span>
            <% } %>
          </td>
          <td>
            <% if (skill.avg_security_score) { %>
            <span class="score <%= skill.avg_security_score >= 7 ? 'score-high' : skill.avg_security_score >= 5 ? 'score-mid' : 'score-low' %>">
              <%= skill.avg_security_score.toFixed(1) %>
            </span>
            <% } else { %>
            <span style="opacity: 0.5">--</span>
            <% } %>
          </td>
          <td><%= skill.review_count %></td>
          <td><%= skill.installs || 0 %></td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <% } else { %>
    <p style="text-align: center; opacity: 0.6; padding: 2rem;">
      No skills match your search. Try broadening your query or removing filters.
    </p>
    <% } %>
  </main>

  <footer class="container">
    <p>skills.gather — Provable AI Skill Reviews | <a href="/llms.txt">llms.txt</a></p>
  </footer>
</body>
</html>
